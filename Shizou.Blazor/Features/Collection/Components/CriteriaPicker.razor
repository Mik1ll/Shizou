@using Shizou.Data.FilterCriteria
@if (_isSumOfProducts)
{
    var or = (OrAnyCriterion)Filter.Criteria;
    <div class="p-2 border border-info">
        <div class="position-relative">
            <span class="text-info bg-body ps-1 pe-1 position-absolute" style="top:-1.1rem;line-height:1rem">OR</span>
        </div>
        @foreach (var and in or.Criteria.Cast<AndAllCriterion>().Append(null))
        {
            <div @key="@and" class="mt-3 p-2 border border-success">
                <div class="position-relative">
                    <span class="text-success bg-body ps-1 pe-1 position-absolute" style="top:-1.1rem;line-height:1rem">AND</span>
                </div>
                @foreach (var (term, idx) in (and?.Criteria ?? new List<AnimeCriterion>()).Append(null).Select((term, idx) => (term, idx)))
                {
                    <div class="border border-secondary p-1 mb-2">
                        <select @key="@term" class="form-select mb-1" @onchange="@(args => AddOrUpdate(or, and, idx, (string)args.Value!))">
                            <option hidden>Pick a term</option>
                            @foreach (var termType in _validTermTypes.Keys)
                            {
                                <option value="@termType" selected="@(termType == term?.GetType().Name)">@termType</option>
                            }
                        </select>
                        @if (and is not null && term is not null)
                        {
                            <EditForm class="ms-3" Model="@term">
                                <DataAnnotationsValidator/>
                                @switch (term)
                                {
                                    case AirDateCriterion airdate:
                                        <InputSelect class="form-select w-auto d-inline" TValue="@AirDateCriterionType"
                                                     Value="@(airdate.AirDateCriterionType)"
                                                     ValueExpression="@(() => airdate.AirDateCriterionType)"
                                                     ValueChanged="@(type => and.Criteria[idx] = airdate with {AirDateCriterionType = type})">
                                            @foreach (var type in Enum.GetValues<AirDateCriterionType>())
                                            {
                                                <option value="@type" selected="@(airdate.AirDateCriterionType == type)">@type</option>
                                            }
                                        </InputSelect>
                                        <br/>
                                        <InputNumber class="form-control d-inline" style="width: 5em" placeholder="Year" TValue="@(int?)"
                                                     Value="@(airdate.Year)"
                                                     ValueExpression="@(() => airdate.Year)"
                                                     ValueChanged="@(year => and.Criteria[idx] = airdate with {Year = year})"/>
                                        <InputNumber class="form-control d-inline" style="width: 5.3em" placeholder="Month" TValue="@(int?)"
                                                     Value="@(airdate.Month)"
                                                     ValueExpression="@(() => airdate.Month)"
                                                     ValueChanged="@(month => and.Criteria[idx] = airdate with {Month = month})"/>
                                        <InputNumber class="form-control d-inline" style="width: 4.3em" placeholder="Day" TValue="@(int?)"
                                                     Value="@(airdate.Day)"
                                                     ValueExpression="@(() => airdate.Day)"
                                                     ValueChanged="@(day => and.Criteria[idx] = airdate with {Year = day})"/>
                                        break;
                                }
                            </EditForm>
                        }
                    </div>
                }
            </div>
        }
    </div>
}
else
{
    <text>Filter in a state that is unable to be modified using this tool</text>
}
